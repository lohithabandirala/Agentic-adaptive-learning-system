# ACTUAL DATABASE SCHEMA - Retrieved from MongoDB Atlas

## ğŸ“Š Database Overview

**Database Name**: `vibathon`  
**Total Collections**: 8  
**Total Documents**: 22  
**Data Size**: 0.01 MB  
**Storage Size**: 0.16 MB  
**Average Document Size**: 0.54 KB

**Connection**: MongoDB Atlas  
**URL**: `mongodb+srv://rahuldusa37:***@cluster0.dcnzaca.mongodb.net/vibathon`

---

## ğŸ—„ï¸ Collections Found (8 Total)

### **1. users** ğŸ‘¤
**Document Count**: 4  
**Purpose**: User authentication (students & teachers)

**Indexes**:
- `_id`: Primary key
- `username`: UNIQUE
- `email`: UNIQUE

**Actual Schema** (from database):
```json
{
  "_id": "ObjectId",
  "username": "string",
  "email": "string",
  "password": "string (bcrypt hashed)",
  "role": "string (student/teacher)",
  "createdAt": "Date",
  "__v": "number"
}
```

**Real Example Document**:
```json
{
  "_id": "68f20d5197a9d8981d5f15c2",
  "username": "rahul",
  "email": "rahuldusa@gmail.com",
  "password": "$2b$10$CdJFVSHq5F4KxvVmLGgInOeqC/LzgL/YlAaHTPV2ajsYqDRWFsJUa",
  "role": "student",
  "createdAt": "2025-10-17T09:33:05.165Z",
  "__v": 0
}
```

**Users in Database**:
1. `rahul` - Student (ID: 68f20d5197a9d8981d5f15c2)
2. `narendar` - Teacher (ID: 68f21bbf97a9d8981d5f15ca)
3. +2 more users

---

### **2. classes** ğŸ“
**Document Count**: 3  
**Purpose**: Course/class management

**Indexes**:
- `_id`: Primary key
- `classCode`: UNIQUE (6-character code for joining)

**Actual Schema** (from database):
```json
{
  "_id": "ObjectId",
  "name": "string",
  "description": "string",
  "classCode": "string (e.g., Q962QU)",
  "teacherId": "string (User._id as string)",
  "students": ["string (User._id)"],
  "tests": ["string (Test.testId)"],
  "createdAt": "Date",
  "__v": "number"
}
```

**Real Example Document**:
```json
{
  "_id": "68f21efe723a2bf6616d4a1e",
  "name": "java",
  "description": "",
  "classCode": "Q962QU",
  "teacherId": "68f21bbf97a9d8981d5f15ca",
  "students": [
    "68f20d5197a9d8981d5f15c2"
  ],
  "tests": [
    "test_1760711872060"
  ],
  "createdAt": "2025-10-17T10:48:30.618Z",
  "__v": 1
}
```

**Classes in Database**:
1. "java" - Code: Q962QU (1 student, 1 test)
2. "java1" - Code: G3F5HE (1 student, 1 test)
3. +1 more class

**Key Observations**:
- Uses `classCode` for student enrollment (not `classId`)
- `teacherId` stored as STRING (converted from ObjectId)
- `students` array stores User IDs as strings
- `tests` array stores Test IDs as strings

---

### **3. tests** ğŸ“
**Document Count**: 4  
**Purpose**: Test templates created by teachers

**Indexes**:
- `_id`: Primary key
- `testId`: UNIQUE (custom string ID)

**Actual Schema** (from database):
```json
{
  "_id": "ObjectId",
  "testId": "string (e.g., test_1760699451096)",
  "testName": "string",
  "classId": "string (Class._id as string)",
  "topic": "string (for AI question generation)",
  "numQuestions": "number",
  "createdBy": "string (User._id as string)",
  "createdAt": "Date",
  "__v": "number"
}
```

**Real Example Document**:
```json
{
  "_id": "68f2243bc256f8e8e44e2a26",
  "testId": "test_1760699451096",
  "testName": "java ",
  "classId": "68f21efe723a2bf6616d4a1e",
  "topic": "java arrays",
  "numQuestions": 5,
  "createdBy": "68f21bbf97a9d8981d5f15ca",
  "createdAt": "2025-10-17T11:10:51.101Z",
  "__v": 0
}
```

**Tests in Database**:
1. "java " - Topic: java arrays (5 questions)
2. "java code" - Topic: arrays in java (10 questions)
3. +2 more tests

**Key Observations**:
- **NO `questionsPerSession` field!** (Not implemented yet in actual DB)
- **NO pre-generated questions** (questions generated by AI dynamically)
- Uses custom `testId` with timestamp format
- All IDs stored as strings (not ObjectId references)

---

### **4. attempts** ğŸ“Š
**Document Count**: 11  
**Purpose**: Track student test attempts

**Indexes**:
- `_id`: Primary key
- `attemptId`: UNIQUE (custom string ID)

**Actual Schema** (from database):
```json
{
  "_id": "ObjectId",
  "attemptId": "string (e.g., attempt_1760700942251)",
  "testId": "string (Test.testId)",
  "studentId": "string (User._id as string)",
  "results": "Array (empty in samples)",
  "currentDifficulty": "string (easy/medium/hard)",
  "index": "number (current question index)",
  "completed": "boolean",
  "startedAt": "Date",
  "__v": "number"
}
```

**Real Example Document**:
```json
{
  "_id": "68f22a0eee1bb9ba6e74a08f",
  "attemptId": "attempt_1760700942251",
  "testId": "test_1760699451096",
  "studentId": "68f20d5197a9d8981d5f15c2",
  "results": [],
  "currentDifficulty": "easy",
  "index": 0,
  "completed": false,
  "startedAt": "2025-10-17T11:35:42.256Z",
  "__v": 0
}
```

**Attempts in Database**: 11 attempts (all with empty `results` arrays - tests not completed)

**Key Observations**:
- **NO session-based fields!** Missing:
  - `currentSession`
  - `totalSessions`
  - `currentSessionQuestions`
  - `sessionAnalytics`
- Simple attempt tracking (old version)
- All attempts have empty `results` (no completed tests yet)
- Uses simple `attemptId` format (just timestamp, no random suffix)

---

### **5. emotiontrackings** ğŸ˜Š
**Document Count**: 0 (EMPTY!)  
**Purpose**: Store webcam emotion data

**Indexes**:
- `_id`: Primary key
- `studentId`: Regular index
- `attemptId`: Regular index
- `timestamp`: Regular index
- Compound: `{studentId: 1, timestamp: -1}`
- Compound: `{attemptId: 1, questionNumber: 1}`

**Expected Schema** (from model, not yet in DB):
```json
{
  "_id": "ObjectId",
  "studentId": "ObjectId",
  "attemptId": "String (after our fix)",
  "timestamp": "Date",
  "emotions": {
    "happy": "Number",
    "sad": "Number",
    "angry": "Number",
    "fear": "Number",
    "neutral": "Number",
    "surprise": "Number",
    "disgust": "Number"
  },
  "dominantEmotion": "String",
  "stressLevel": "Number",
  "questionNumber": "Number",
  "createdAt": "Date",
  "updatedAt": "Date"
}
```

**Status**: âš ï¸ **Collection exists but has NO data** - Emotion tracking not yet used

---

### **6. materials** ğŸ“š
**Document Count**: 0 (EMPTY!)  
**Purpose**: Learning materials shared by teachers

**Indexes**:
- `_id`: Primary key
- `id`: UNIQUE

**Status**: âš ï¸ **Collection exists but has NO data** - Materials feature not used

---

### **7. studentanalytics** ğŸ“ˆ
**Document Count**: 0 (EMPTY!)  
**Purpose**: Aggregated student performance analytics

**Indexes**:
- `_id`: Primary key
- `studentId`: UNIQUE
- `overallPercentage`: Descending index
- `lastUpdated`: Descending index

**Status**: âš ï¸ **Collection exists but has NO data** - Analytics not yet calculated

---

### **8. personalizedquestionsets** ğŸ¯
**Document Count**: 0 (EMPTY!)  
**Purpose**: Personalized question sets for students

**Indexes**:
- `_id`: Primary key
- `studentId`: Regular index
- `setId`: UNIQUE
- Compound: `{studentId: 1, createdAt: -1}`
- `questions.used`: Regular index

**Status**: âš ï¸ **Collection exists but has NO data** - Not using pre-generated questions (ADK generates dynamically)

---

## ğŸ” Key Findings & Discrepancies

### âŒ **Missing Features in Actual Database**

1. **Session-Based Testing NOT Implemented**:
   - Attempt model missing: `currentSession`, `totalSessions`, `currentSessionQuestions`, `sessionAnalytics`
   - Test model missing: `questionsPerSession`
   - Using old simple attempt tracking

2. **No Emotion Data**:
   - `emotiontrackings` collection exists but is **empty**
   - Emotion tracking feature not actively used yet

3. **No Completed Tests**:
   - All 11 attempts have empty `results` arrays
   - Students started tests but didn't complete them

4. **Data Type Inconsistencies**:
   - Many ObjectId references stored as **strings** (not proper ObjectId)
   - Examples: `teacherId`, `studentId`, `classId` in various collections

### âœ… **What's Working**

1. **User Authentication**: 4 users (students + teachers)
2. **Class Management**: 3 classes with enrollment
3. **Test Creation**: 4 tests created by teachers
4. **Attempt Tracking**: 11 test attempts started

---

## ğŸ”§ Database vs Code Mismatch

### **Your Code Has** (from models):
- âœ… Session-based Attempt model with `sessionAnalytics`
- âœ… EmotionTracking model with full schema
- âœ… Test model with `questionsPerSession`
- âœ… ADK Agent with database querying

### **Your Database Has** (actual data):
- âŒ Old simple Attempt model (no sessions)
- âŒ Empty EmotionTracking collection
- âŒ Test model without `questionsPerSession`
- âŒ No session analytics data

### **Reason**:
Your backend code is **NEWER** than the database data. The database has old data from before you implemented session-based testing and ADK integration.

---

## ğŸ“Š Data Relationships (Actual)

```
User (4 docs)
  â”œâ”€ role: "student" | "teacher"
  â”‚
  â”œâ”€ Students enrolled in â†’ Class (3 docs)
  â”‚                            â”œâ”€ classCode (for joining)
  â”‚                            â”œâ”€ students: [userId]
  â”‚                            â””â”€ tests: [testId]
  â”‚
  â”œâ”€ Teachers create â†’ Test (4 docs)
  â”‚                      â”œâ”€ topic (for AI)
  â”‚                      â”œâ”€ numQuestions
  â”‚                      â””â”€ NO questionsPerSession
  â”‚
  â””â”€ Students take â†’ Attempt (11 docs)
                       â”œâ”€ results: [] (all empty)
                       â”œâ”€ completed: false (all incomplete)
                       â””â”€ NO session data
```

---

## ğŸ¯ What This Means

### **Current State**:
1. âœ… Users can register and login
2. âœ… Teachers can create classes
3. âœ… Students can enroll in classes
4. âœ… Teachers can create tests
5. âœ… Students can START tests
6. âŒ Students CANNOT complete tests (old model)
7. âŒ NO emotion tracking happening
8. âŒ NO session-based delivery
9. âŒ NO ADK agent querying data (no data to query!)

### **Why ADK Queries Failed**:
The database queries are failing because:
1. **No emotion data** - `emotiontrackings` is empty
2. **No completed attempts** - All `results` arrays are empty
3. **Old attempt structure** - Missing session fields

### **To Make It Work**:
Your new code with ADK integration is ready, but you need to:
1. âœ… Use the new backend (already running)
2. âœ… Start a NEW test (will use new session-based model)
3. âœ… Complete the test (will populate results)
4. âœ… Enable webcam (will populate emotiontrackings)
5. Then ADK agent will have data to query!

---

## ğŸš€ Recommended Actions

### **Option 1: Keep Old Data** (For History)
- Old attempts stay in database
- New attempts use new schema
- Both models coexist

### **Option 2: Clean Slate** (Recommended for Testing)
**Drop these collections** to start fresh:
```javascript
db.attempts.drop();
db.emotiontrackings.drop();
db.studentanalytics.drop();
db.personalizedquestionsets.drop();
```

**Keep these collections**:
- `users` (login accounts)
- `classes` (course data)
- `tests` (test templates)

Then start a new test - it will use the new session-based model with ADK integration!

---

## ğŸ“ Summary

**Your actual database has**:
- 8 collections
- 22 documents total
- OLD schema (pre-ADK integration)
- NO emotion data
- NO completed tests
- NO session-based structure

**Your new code expects**:
- Session-based attempts
- Emotion tracking data
- Completed test results
- ADK-queryable performance history

**Solution**: Start a NEW test with your fixed backend to populate data with the new schema! ğŸ‰

---

**Database inspection completed!**  
**File**: `DATABASE_DESIGN.md` = Theoretical design  
**File**: `ACTUAL_DATABASE_SCHEMA.md` = This file (real data)
