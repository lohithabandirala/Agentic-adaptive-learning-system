# 🚀 RUN GOOGLE ADK AGENT-BASED SYSTEM

## ✅ SETUP COMPLETE

You now have a **TRUE Google ADK Agent Development Kit** implementation with:

### 🤖 **Agent Architecture**
- **6 Agent Tools** (function calling):
  1. `query_student_performance` - Analyzes student history and accuracy
  2. `query_emotion_patterns` - Checks stress levels and emotional state
  3. `query_topic_mastery` - Identifies weak/strong topic areas
  4. `query_recent_attempts` - Avoids question repetition
  5. `save_question_analytics` - Records agent reasoning for each question
  6. `save_session_analytics` - Pushes comprehensive session analytics to database

- **Agent Reasoning Workflow**: 
  - Agent DECIDES which DB queries to run
  - Agent REASONS about student data
  - Agent GENERATES personalized questions
  - Agent SAVES analytics automatically

### 📦 **Credentials Configured**
- ✅ Google Gemini API Key in `.env`
- ✅ MongoDB Atlas Connection in `.env`
- ✅ Google Cloud Project ID: `scenic-shift-473208-u2`
- ✅ Service Account JSON: `scenic-shift-473208-u2-61802cf35017.json`
- ✅ Vertex AI Location: `us-central1`
- ✅ Model: `gemini-2.0-flash-exp` (latest agent-capable model)

---

## 🏃 HOW TO RUN THE PROJECT

### **STEP 1: Start Backend Server**

Open **Terminal 1** (CMD):

```cmd
cd "c:\Users\NARENDAR\Documents\Hackathons\vibethon\approach with google adk\backend"
node server.js
```

You should see:
```
✅ MongoDB Connected: vibeathonx.ltph9mh.mongodb.net
🚀 Server running on port 3000
```

**KEEP THIS TERMINAL RUNNING!**

---

### **STEP 2: Test Question Generation with ADK Agent**

Open **Terminal 2** (CMD):

```cmd
cd "c:\Users\NARENDAR\Documents\Hackathons\vibethon\approach with google adk"
.venv\Scripts\activate
python real_detailed_test.py
```

This script will:
1. ✅ Register a student
2. ✅ Start an assessment session
3. ✅ **Call ADK Agent to generate a question** (you'll see agent tool calls in Terminal 1!)
4. ✅ Run emotion detection
5. ✅ Submit answer with feedback
6. ✅ **Call ADK Agent for session completion analytics**

---

## 🔍 WHAT TO WATCH FOR

### **In Terminal 1 (Backend Server):**

When ADK Agent generates a question, you'll see:

```
🤖 Starting ADK Agent - Question Generation
Student: 676af..., Session: 676af..., Subject: biology

🔄 Agent Iteration 1: Function calling...
🔧 Agent Tool Call: query_student_performance
📥 Arguments: { "studentId": "676af..." }
📤 Tool Result: { "overallAccuracy": 75.5, "totalAttempts": 20, ... }

🔄 Agent Iteration 2: Function calling...
🔧 Agent Tool Call: query_emotion_patterns
📥 Arguments: { "studentId": "676af..." }
📤 Tool Result: { "averageStressLevel": 2.3, "emotionalStability": "stable", ... }

🔄 Agent Iteration 3: Function calling...
🔧 Agent Tool Call: query_topic_mastery
📥 Arguments: { "studentId": "676af...", "subject": "biology" }
📤 Tool Result: { "weakAreas": ["cellular respiration"], "strongAreas": ["photosynthesis"], ... }

🔄 Agent Iteration 4: Function calling...
🔧 Agent Tool Call: save_question_analytics
📥 Arguments: { "sessionId": "676af...", "questionData": {...}, "reasoning": "..." }
📤 Tool Result: { "success": true, "analysisId": "676af..." }

✅ Agent completed reasoning
📄 Agent Response: Generated question about cellular respiration...
```

This shows the agent is **REASONING** and **DECIDING** what data to query!

### **In Terminal 2 (Python Client):**

You'll see:
```
✅ Question Generated by ADK Agent!
🤖 Agent Reasoning: "Based on student's 65% accuracy in cellular respiration (weak area) 
    and stable emotional state (stress 2/5), I generated a medium difficulty question..."
⚙️ Agent Iterations: 4
📊 Difficulty: medium
📚 Topic: Cellular Respiration
```

---

## 📊 VERIFY ANALYTICS IN DATABASE

After completing a session, check MongoDB Atlas:

1. Go to: https://cloud.mongodb.com/
2. Navigate to: `vibeathonx` → Database → `test` → Collections → `aianalyses`
3. You should see TWO types of analytics:

### **Question Analytics** (saved per question):
```json
{
  "_id": "...",
  "student": "676af...",
  "session": "676af...",
  "analysisType": "question_generation",
  "insights": {
    "generatedQuestion": {
      "question": "What is the primary function of mitochondria?",
      "difficulty": "medium",
      "topic": "Cellular Respiration"
    },
    "reasoning": "Student has 65% accuracy in this topic (weak area)...",
    "studentInsights": {
      "overallAccuracy": 75.5,
      "emotionalStability": "stable"
    }
  }
}
```

### **Session Completion Analytics** (saved at end):
```json
{
  "_id": "...",
  "student": "676af...",
  "session": "676af...",
  "analysisType": "session_completion",
  "insights": {
    "sessionSummary": {
      "overallScore": 80,
      "topicsAnalyzed": ["biology"],
      "strengths": ["photosynthesis"],
      "weaknesses": ["cellular respiration"],
      "recommendations": ["Focus on ATP production cycles"],
      "emotionalSummary": "Student remained calm and focused (avg stress 2.1/5)"
    }
  },
  "performanceMetrics": {
    "overallScore": 80,
    "strengths": ["photosynthesis"],
    "weaknesses": ["cellular respiration"]
  }
}
```

---

## 🎯 TESTING SPECIFIC FEATURES

### **1. Test Question Generation ONLY**

Create `test_adk_question.py`:

```python
import requests

BASE_URL = "http://localhost:3000/api"

# Register student
student = requests.post(f"{BASE_URL}/students/register", json={
    "student_id": "test_student_001",
    "name": "Test Student",
    "grade": 10
}).json()

# Start session
session = requests.post(f"{BASE_URL}/sessions/start", json={
    "student_id": "test_student_001",
    "topic": "mathematics",
    "total_questions": 1
}).json()

print(f"Session: {session['session_id']}")

# Generate question with ADK AGENT
question = requests.post(f"{BASE_URL}/sessions/question/next", json={
    "session_id": session['session_id'],
    "student_id": "test_student_001",
    "topic": "mathematics",
    "question_number": 1
}).json()

print("\n✅ QUESTION FROM ADK AGENT:")
print(f"Question: {question['question']['question']}")
print(f"Difficulty: {question['question']['difficulty']}")
print(f"Agent Used: {question['adk_agent']}")
print(f"Agent Iterations: {question['iterations']}")
print(f"\n🧠 Agent Reasoning:\n{question['reasoning']}")
```

Run: `python test_adk_question.py`

### **2. Test Emotion Detection ONLY**

```cmd
python emotion_detector.py
```

Watch webcam for 15 seconds, see emotion analysis.

### **3. Test Complete Flow**

```cmd
python real_detailed_test.py
```

Full end-to-end test with question generation + emotion + feedback + analytics.

---

## 🐛 TROUBLESHOOTING

### **"Agent exceeded maximum iterations"**

The agent is stuck in a loop. Check:
1. MongoDB is connected (check Terminal 1)
2. Student and Session exist in database
3. Agent has proper credentials (check `.env`)

### **"Module not found: @google-cloud/vertexai"**

Run in backend folder:
```cmd
npm install @google-cloud/vertexai google-auth-library
```

### **"Failed to authenticate with Google Cloud"**

1. Verify `scenic-shift-473208-u2-61802cf35017.json` exists in `backend/` folder
2. Check `GOOGLE_APPLICATION_CREDENTIALS` path in `.env`
3. Try absolute path: `C:\Users\NARENDAR\Documents\Hackathons\vibethon\approach with google adk\backend\scenic-shift-473208-u2-61802cf35017.json`

### **Backend not responding**

1. Make sure backend is running (`node server.js` in Terminal 1)
2. Check port 3000 is available: `netstat -ano | findstr :3000`
3. Restart server if needed

---

## 📈 ARCHITECTURE COMPARISON

### **OLD: Direct API Calls**
```
Client → API → questionService.js → Gemini API → Response
(No reasoning, just prompt → answer)
```

### **NEW: Google ADK Agent** ✨
```
Client → API → adkAgentService.js → ADK Agent
  ├─ Agent queries DB (query_student_performance)
  ├─ Agent queries emotions (query_emotion_patterns)
  ├─ Agent queries topics (query_topic_mastery)
  ├─ Agent REASONS about data
  ├─ Agent generates question
  └─ Agent saves analytics (save_question_analytics)
→ Response with reasoning + analytics
```

**The agent DECIDES what data it needs and how to use it!**

---

## 🎉 SUCCESS CRITERIA

You know it's working when:

1. ✅ Terminal 1 shows agent tool calls (`🔧 Agent Tool Call: query_student_performance`)
2. ✅ Python client receives `"adk_agent": true` in response
3. ✅ MongoDB `aianalyses` collection has new documents
4. ✅ Questions adapt to student weak areas
5. ✅ Session completion creates comprehensive analytics

---

## 📚 NEXT STEPS

1. **Run the tests** - Verify everything works
2. **Check MongoDB** - See analytics being saved
3. **Try different subjects** - Test with "mathematics", "history", "science"
4. **Monitor agent reasoning** - Watch Terminal 1 for tool calls
5. **Customize agent instructions** - Edit `adkAgentService.js` to change agent behavior

---

## 🚨 IMPORTANT NOTES

1. **Backend MUST be running** in Terminal 1 for everything to work
2. **Python virtual environment** must be activated (`.venv\Scripts\activate`)
3. **MongoDB Atlas** must be accessible (check firewall/network)
4. **Google Cloud credentials** must be valid (service account JSON)
5. **Agent uses gemini-2.0-flash-exp** - supports function calling and reasoning

---

## 📞 NEED HELP?

If you see errors, check:
1. Backend server logs in Terminal 1
2. MongoDB connection status
3. Google Cloud authentication
4. Python virtual environment activated

**Ready to test? Start with `node server.js` in Terminal 1! 🚀**
